<!doctype html><html lang=fr dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Créer un serveur proxy avec Pfsense et Squid | Thomas WIMART</title><meta name=keywords content><meta name=description content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel Vmware.
Topologie de notre réseau Voila la topologie du réseau que nous allons utiliser dans ce tuto:
Pour accéder à Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du réseau local &ldquo;LAN&rdquo;. Ici la subtilité est que si &ldquo;Linux&rdquo; veut accéder à certaines page web, ces requêtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;."><meta name=author content="Thomas"><link rel=canonical href=https://twimart.github.io/fr/notes/proxy/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://twimart.github.io/favicon.ico/><link rel=icon type=image/png sizes=16x16 href=https://twimart.github.io/favicon-16x16.png/><link rel=icon type=image/png sizes=32x32 href=https://twimart.github.io/favicon-32x32.png/><link rel=apple-touch-icon href=https://twimart.github.io/apple-touch-icon.png/><link rel=mask-icon href=https://twimart.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=fr href=https://twimart.github.io/fr/notes/proxy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Créer un serveur proxy avec Pfsense et Squid"><meta property="og:description" content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel Vmware.
Topologie de notre réseau Voila la topologie du réseau que nous allons utiliser dans ce tuto:
Pour accéder à Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du réseau local &ldquo;LAN&rdquo;. Ici la subtilité est que si &ldquo;Linux&rdquo; veut accéder à certaines page web, ces requêtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;."><meta property="og:type" content="article"><meta property="og:url" content="https://twimart.github.io/fr/notes/proxy/"><meta property="article:section" content="notes"><meta property="article:published_time" content="2022-12-01T09:04:41+01:00"><meta property="article:modified_time" content="2022-12-01T09:04:41+01:00"><meta property="og:site_name" content="Thomas WIMART"><meta name=twitter:card content="summary"><meta name=twitter:title content="Créer un serveur proxy avec Pfsense et Squid"><meta name=twitter:description content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel Vmware.
Topologie de notre réseau Voila la topologie du réseau que nous allons utiliser dans ce tuto:
Pour accéder à Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du réseau local &ldquo;LAN&rdquo;. Ici la subtilité est que si &ldquo;Linux&rdquo; veut accéder à certaines page web, ces requêtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://twimart.github.io/fr/notes/"},{"@type":"ListItem","position":2,"name":"Créer un serveur proxy avec Pfsense et Squid","item":"https://twimart.github.io/fr/notes/proxy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Créer un serveur proxy avec Pfsense et Squid","name":"Créer un serveur proxy avec Pfsense et Squid","description":"Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel Vmware.\nTopologie de notre réseau Voila la topologie du réseau que nous allons utiliser dans ce tuto:\nPour accéder à Internet, le PC \u0026ldquo;Linux\u0026rdquo; passera par le routeur \u0026ldquo;Pfsense\u0026rdquo;, afin de sortir du réseau local \u0026ldquo;LAN\u0026rdquo;. Ici la subtilité est que si \u0026ldquo;Linux\u0026rdquo; veut accéder à certaines page web, ces requêtes passeront d\u0026rsquo;abord par notre serveur proxy \u0026ldquo;Squid\u0026rdquo;.","keywords":[],"articleBody":"Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel Vmware.\nTopologie de notre réseau Voila la topologie du réseau que nous allons utiliser dans ce tuto:\nPour accéder à Internet, le PC “Linux” passera par le routeur “Pfsense”, afin de sortir du réseau local “LAN”. Ici la subtilité est que si “Linux” veut accéder à certaines page web, ces requêtes passeront d’abord par notre serveur proxy “Squid”. “Squid” pourra alors bloquer certaines pages web ou encore enregistrer certaine données dans sont cache afin d’améliorer les performances.\nJe précise que ce shéma ne sert que d’illustration, Pfsense et Squid ne forment en réalité qu’une seule machine.\nCréation de la machine virtuelle Sur la page de téléchargement de Pfsense, télécharger l’iso de notre future machine virtuelle. Je précise que vous allez obtenir fichier .gz, vous devez extraire ce fichier sur votre ordinateur.\nEnsuite, sur Vmware, vous pouvez créer votre machine virtuelle. (vous pouvez mon suivre mon tutoril ici.)\nfaire un tuto ⬆️\nInstallation de Pfsense Vous pouvez alors démarrer votre machine virtuelle.\nCliquer sur “Accept”.\nSélectionnez “Install”, puis “OK”\nL’installateur va alors vous demander de sélectionner la disposition de votre clavier (j’ai un clavier français). Sélectionnez la disposition qui vous convient, puis appuyer sur “Select”.\nConfirmer votre choix.\nOn nous demande ensuite comment partionner notre disque. Choisissez “Auto (UFS) BIOS”, puis “OK”.\nPfsense va alors démmarer son installation:\nVous redémarrerez la machine virtuelle quand l’installateur vous le proposera.\nAu redémarrage, on vous demandera si les VLANS doivent être configurés. Appuyez sur “n” puis “Enter”\nEnsuite, vous devez dire à Pfsense quelles interfaces correspondent au WAN et au LAN. Ne vous inquiètez pas si vous ne savez pas, on pourra changer cela plus tard! Dans mon cas, j’ai mis:\n“em1” pour le WAN “em0” pour le LAN Puis confirmer en appuyant sur “y”:\nEt nous avons enfin fini l’installation de Pfsense! Vous devrez maintenant arriver sur le menu de configuration principal.\nLa suite arrive bientôt ! 😉\n","wordCount":"340","inLanguage":"fr","datePublished":"2022-12-01T09:04:41+01:00","dateModified":"2022-12-01T09:04:41+01:00","author":{"@type":"Person","name":"Thomas"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://twimart.github.io/fr/notes/proxy/"},"publisher":{"@type":"Organization","name":"Thomas WIMART","logo":{"@type":"ImageObject","url":"https://twimart.github.io/favicon.ico/"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://twimart.github.io/fr/ accesskey=h title="WIMART Thomas (Alt + H)"><img src=https://twimart.github.io/apple-touch-icon.png alt aria-label=logo height=30>WIMART Thomas</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://twimart.github.io/ title=Anglais aria-label="🌍 EN ">🌍 EN</a></li></ul></div></div><ul id=menu><li><a href=https://twimart.github.io/fr/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://twimart.github.io/fr/frtags/ title=Tags><span>Tags</span></a></li><li><a href=https://twimart.github.io/fr/search/ title="Recherche 🔍 (Alt + /)" accesskey=/><span>Recherche 🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://twimart.github.io/fr/>Accueil</a>&nbsp;»&nbsp;<a href=https://twimart.github.io/fr/notes/>Notes</a></div><h1 class=post-title>Créer un serveur proxy avec Pfsense et Squid</h1><div class=post-meta><span title='2022-12-01 09:04:41 +0100 +0100'>décembre 1, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Thomas</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table des matières</span></summary><div class=inner><ul><li><a href=#topologie-de-notre-r%c3%a9seau aria-label="Topologie de notre réseau">Topologie de notre réseau</a></li><li><a href=#cr%c3%a9ation-de-la-machine-virtuelle aria-label="Création de la machine virtuelle">Création de la machine virtuelle</a></li><li><a href=#installation-de-pfsense aria-label="Installation de Pfsense">Installation de Pfsense</a></li></ul></div></details></div><div class=post-content><p>Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, créées sous le logiciel <em>Vmware</em>.</p><h2 id=topologie-de-notre-réseau>Topologie de notre réseau<a hidden class=anchor aria-hidden=true href=#topologie-de-notre-réseau>#</a></h2><p>Voila la topologie du réseau que nous allons utiliser dans ce tuto:</p><p><img loading=lazy src=/images/reseau.png alt=reseau></p><p>Pour accéder à Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du réseau local &ldquo;LAN&rdquo;. Ici la subtilité est que si &ldquo;Linux&rdquo; veut accéder à certaines page web, ces requêtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;.<br>&ldquo;Squid&rdquo; pourra alors bloquer certaines pages web ou encore enregistrer certaine données dans sont cache afin d&rsquo;améliorer les performances.</p><p><em>Je précise que ce shéma ne sert que d&rsquo;illustration, Pfsense et Squid ne forment en réalité qu&rsquo;une seule machine.</em></p><h2 id=création-de-la-machine-virtuelle>Création de la machine virtuelle<a hidden class=anchor aria-hidden=true href=#création-de-la-machine-virtuelle>#</a></h2><p>Sur la page de téléchargement de <a href=https://www.pfsense.org/download/>Pfsense</a>, télécharger l&rsquo;iso de notre future machine virtuelle. Je précise que vous allez obtenir fichier .gz, vous devez extraire ce fichier sur votre ordinateur.</p><p>Ensuite, sur Vmware, vous pouvez créer votre machine virtuelle. (vous pouvez mon suivre mon tutoril <a href=/fr/notes/vmware>ici</a>.)</p><p><em><strong>faire un tuto ⬆️</strong></em></p><h2 id=installation-de-pfsense>Installation de Pfsense<a hidden class=anchor aria-hidden=true href=#installation-de-pfsense>#</a></h2><p>Vous pouvez alors démarrer votre machine virtuelle.</p><p><img loading=lazy src=/images/pfsense/pfsense1.png alt=pfsense1></p><p>Cliquer sur &ldquo;Accept&rdquo;.</p><p><img loading=lazy src=/images/pfsense/pfsense2.png alt=pfsense2></p><p>Sélectionnez &ldquo;Install&rdquo;, puis &ldquo;OK&rdquo;</p><p>L&rsquo;installateur va alors vous demander de sélectionner la disposition de votre clavier (j&rsquo;ai un clavier français). Sélectionnez la disposition qui vous convient, puis appuyer sur &ldquo;Select&rdquo;.</p><p><img loading=lazy src=/images/pfsense/pfsense3.png alt=pfsense3></p><p>Confirmer votre choix.</p><p><img loading=lazy src=/images/pfsense/pfsense4.png alt=pfsense4></p><p>On nous demande ensuite comment partionner notre disque. Choisissez &ldquo;Auto (UFS) BIOS&rdquo;, puis &ldquo;OK&rdquo;.</p><p><img loading=lazy src=/images/pfsense/pfsense5.png alt=pfsense5></p><p>Pfsense va alors démmarer son installation:</p><p><img loading=lazy src=/images/pfsense/pfsense6.png alt=pfsense6></p><p>Vous redémarrerez la machine virtuelle quand l&rsquo;installateur vous le proposera.</p><p>Au redémarrage, on vous demandera si les VLANS doivent être configurés. Appuyez sur &ldquo;n&rdquo; puis &ldquo;Enter&rdquo;</p><p><img loading=lazy src=/images/pfsense/pfsense7.png alt=pfsense7></p><p>Ensuite, vous devez dire à Pfsense quelles interfaces correspondent au WAN et au LAN. Ne vous inquiètez pas si vous ne savez pas, on pourra changer cela plus tard!
Dans mon cas, j&rsquo;ai mis:</p><ul><li>&ldquo;em1&rdquo; pour le WAN</li><li>&ldquo;em0&rdquo; pour le LAN</li></ul><p><img loading=lazy src=/images/pfsense/pfsense8.png alt=pfsense8></p><p>Puis confirmer en appuyant sur &ldquo;y&rdquo;:</p><p><img loading=lazy src=/images/pfsense/pfsense9.png alt=pfsense9></p><p>Et nous avons enfin fini l&rsquo;installation de Pfsense! Vous devrez maintenant arriver sur le menu de configuration principal.</p><p><img loading=lazy src=/images/pfsense/pfsense10.png alt=pfsense10></p><p>La suite arrive bientôt ! 😉</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://twimart.github.io/fr/frtags/pfsense/>pfsense</a></li><li><a href=https://twimart.github.io/fr/frtags/proxy/>proxy</a></li></ul><nav class=paginav><a class=prev href=https://twimart.github.io/fr/notes/vmware/><span class=title>« Page précédente</span><br><span>Créer une machine virtuelle avec Vmware</span></a>
<a class=next href=https://twimart.github.io/fr/notes/cisco-ssh/><span class=title>Page suivante »</span><br><span>Etablir une connexion SSH sur un appareil Cisco</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://twimart.github.io/fr/>Thomas WIMART</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copier";function s(){t.innerHTML="Copié !",setTimeout(()=>{t.innerHTML="Copier"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>