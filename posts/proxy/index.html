<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Create a proxy server with Pfsense and Squid | WIMART Thomas</title><meta name=keywords content="proxy,pfsense"><meta name=description content="In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under Vmware Workstation 16 Pro.
The different parts of this tutorial:
Part-1
Part-2
Part-3
Part-4
Part-5
Topology of our network Here is the network topology that we will use in this tutorial:
To access the Internet, &ldquo;PC1&rdquo; will go through the &ldquo;Pfsense&rdquo; router, in order to leave the local network &ldquo;LAN&rdquo;."><meta name=author content="Thomas"><link rel=canonical href=https://www.thomaswimart.fr/posts/proxy/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.thomaswimart.fr/favicon.ico/><link rel=icon type=image/png sizes=16x16 href=https://www.thomaswimart.fr/favicon-16x16.png/><link rel=icon type=image/png sizes=32x32 href=https://www.thomaswimart.fr/favicon-32x32.png/><link rel=apple-touch-icon href=https://www.thomaswimart.fr/apple-touch-icon.png/><link rel=mask-icon href=https://www.thomaswimart.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.thomaswimart.fr/posts/proxy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Create a proxy server with Pfsense and Squid"><meta property="og:description" content="In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under Vmware Workstation 16 Pro.
The different parts of this tutorial:
Part-1
Part-2
Part-3
Part-4
Part-5
Topology of our network Here is the network topology that we will use in this tutorial:
To access the Internet, &ldquo;PC1&rdquo; will go through the &ldquo;Pfsense&rdquo; router, in order to leave the local network &ldquo;LAN&rdquo;."><meta property="og:type" content="article"><meta property="og:url" content="https://www.thomaswimart.fr/posts/proxy/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-01T10:29:45+01:00"><meta property="article:modified_time" content="2022-12-01T10:29:45+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Create a proxy server with Pfsense and Squid"><meta name=twitter:description content="In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under Vmware Workstation 16 Pro.
The different parts of this tutorial:
Part-1
Part-2
Part-3
Part-4
Part-5
Topology of our network Here is the network topology that we will use in this tutorial:
To access the Internet, &ldquo;PC1&rdquo; will go through the &ldquo;Pfsense&rdquo; router, in order to leave the local network &ldquo;LAN&rdquo;."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.thomaswimart.fr/posts/"},{"@type":"ListItem","position":2,"name":"Create a proxy server with Pfsense and Squid","item":"https://www.thomaswimart.fr/posts/proxy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Create a proxy server with Pfsense and Squid","name":"Create a proxy server with Pfsense and Squid","description":"In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under Vmware Workstation 16 Pro.\nThe different parts of this tutorial:\nPart-1\nPart-2\nPart-3\nPart-4\nPart-5\nTopology of our network Here is the network topology that we will use in this tutorial:\nTo access the Internet, \u0026ldquo;PC1\u0026rdquo; will go through the \u0026ldquo;Pfsense\u0026rdquo; router, in order to leave the local network \u0026ldquo;LAN\u0026rdquo;.","keywords":["proxy","pfsense"],"articleBody":"In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under Vmware Workstation 16 Pro.\nThe different parts of this tutorial:\nPart-1\nPart-2\nPart-3\nPart-4\nPart-5\nTopology of our network Here is the network topology that we will use in this tutorial:\nTo access the Internet, “PC1” will go through the “Pfsense” router, in order to leave the local network “LAN”. Here the subtlety is that if “PC1” wants to access some web pages, its requests will first go through our proxy server “Squid”.\n“Squid” will then be able to block some web pages or save some data in its cache to improve performance.\n*I specify that this schema is only an illustration, Pfsense and Squid are in fact only one machine in our case.\nCreation of the virtual machine On the download page of Pfsense, download the iso of our future virtual router. I specify that you will get .gz file, you have to extract this file on your computer.\nAlso download the iso of a VM, for PC1. Personally, I will use a Linux distribution Ubuntu, which will do the trick, but you are free to use any OS you like.\nThen, on Vmware, you can create the virtual machines (you can follow my tutorial here.\nSetting up virtual machines Once the machines are created, we will have to modify their parameters. Indeed, our Pfsense router has 2 interfaces: one LAN and one WAN. So we will have to add one to it, and set the parameters directly.\n⚠️Your computer must be connected to the Internet.\nGo to the VM settings: 2. Press “Add”:\n3. Select “Network Adaptater”, then “Finish”:\n4. We will now set up our two interfaces. Press on the first one, then on “Advanced”.\n5. Press “Generate”, and note (I insist) the last two bytes of the MAC address that was just generated. It’s normal to not have the same value as me 😉 . Then “OK”.\n6. Then press the “Lan Segments” button:\n7. We will create a new LAN segment. Click on “Add”, give it the name you want, then “OK”.\n8. Finally, still on the first interface, in the “Network Connection” section, select LAN segment, then choose the LAN segment you just created.\nWe have just specified that the first interface will be part of the LAN.\nFor the second interface of our Pfsense router, repeat the 4th and 5th step of configuration of the first interface. Then select “Bridged”, and “OK” (bottom right).\nOur Pfsense virtual machine is now ready to start!\n⚠️Also think about configuring the “PC1” machine. To do this, choose the “Network Adaptater” of your VM, then again select “LAN segment”, choosing the LAN segment you put for the first interface of the Pfsense router:\nYou can then start your Pfsense machine.\nThe next part of this tutorial is ➡️ here ⬅️\n","wordCount":"486","inLanguage":"en","datePublished":"2022-12-01T10:29:45+01:00","dateModified":"2022-12-01T10:29:45+01:00","author":{"@type":"Person","name":"Thomas"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thomaswimart.fr/posts/proxy/"},"publisher":{"@type":"Organization","name":"WIMART Thomas","logo":{"@type":"ImageObject","url":"https://www.thomaswimart.fr/favicon.ico/"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.thomaswimart.fr/ accesskey=h title="WIMART Thomas (Alt + H)"><img src=https://www.thomaswimart.fr/apple-touch-icon.png alt aria-label=logo height=30>WIMART Thomas</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.thomaswimart.fr/fr/ title=French aria-label="🌍 FR ">🌍 FR</a></li></ul></div></div><ul id=menu><li><a href=https://www.thomaswimart.fr/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://www.thomaswimart.fr/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.thomaswimart.fr/search/ title="Search 🔍 (Alt + /)" accesskey=/><span>Search 🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.thomaswimart.fr/>Home</a>&nbsp;»&nbsp;<a href=https://www.thomaswimart.fr/posts/>Posts</a></div><h1 class=post-title>Create a proxy server with Pfsense and Squid</h1><div class=post-meta><span title='2022-12-01 10:29:45 +0100 +0100'>December 1, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Thomas</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#topology-of-our-network aria-label="Topology of our network">Topology of our network</a></li><li><a href=#creation-of-the-virtual-machine aria-label="Creation of the virtual machine">Creation of the virtual machine</a></li><li><a href=#setting-up-virtual-machines aria-label="Setting up virtual machines">Setting up virtual machines</a></li></ul></div></details></div><div class=post-content><p>In this note, we will see how to install a proxy server, using Pfsense and Squid. We will use virtual machines, created under <em>Vmware Workstation 16 Pro</em>.</p><p>The different parts of this tutorial:</p><ul><li><p><a href=/posts/proxy>Part-1</a></p></li><li><p><a href=/proxy/proxy2>Part-2</a></p></li><li><p><a href=/proxy/proxy3>Part-3</a></p></li><li><p><a href=/proxy/proxy4>Part-4</a></p></li><li><p><a href=/proxy/proxy5>Part-5</a></p></li></ul><h2 id=topology-of-our-network>Topology of our network<a hidden class=anchor aria-hidden=true href=#topology-of-our-network>#</a></h2><p>Here is the network topology that we will use in this tutorial:</p><p><img loading=lazy src=/images/reseaux.png alt=network></p><p>To access the Internet, &ldquo;PC1&rdquo; will go through the &ldquo;Pfsense&rdquo; router, in order to leave the local network &ldquo;LAN&rdquo;. Here the subtlety is that if &ldquo;PC1&rdquo; wants to access some web pages, its requests will first go through our proxy server &ldquo;Squid&rdquo;.</p><p>&ldquo;Squid&rdquo; will then be able to block some web pages or save some data in its cache to improve performance.</p><p>*I specify that this schema is only an illustration, Pfsense and Squid are in fact only one machine in our case.</p><h2 id=creation-of-the-virtual-machine>Creation of the virtual machine<a hidden class=anchor aria-hidden=true href=#creation-of-the-virtual-machine>#</a></h2><p>On the download page of <a href=https://www.pfsense.org/download/>Pfsense</a>, download the iso of our future virtual router. I specify that you will get .gz file, you have to extract this file on your computer.</p><p>Also download the iso of a VM, for PC1. Personally, I will use a Linux distribution Ubuntu, which will do the trick, but you are free to use any OS you like.</p><p>Then, on Vmware, you can create the virtual machines (you can follow my tutorial <a href=/posts/vmware>here</a>.</p><h2 id=setting-up-virtual-machines>Setting up virtual machines<a hidden class=anchor aria-hidden=true href=#setting-up-virtual-machines>#</a></h2><p>Once the machines are created, we will have to modify their parameters. Indeed, our Pfsense router has 2 interfaces: one LAN and one WAN. So we will have to add one to it, and set the parameters directly.</p><p>⚠️<em><strong>Your computer must be connected to the Internet.</strong></em></p><ol><li>Go to the VM settings:</li></ol><p><img loading=lazy src=/images/freebsd/freebsd1.png alt=freebsd1>
2. Press &ldquo;Add&rdquo;:</p><p><img loading=lazy src=/images/freebsd/freebsd2.png alt=freebsd2>
3. Select &ldquo;Network Adaptater&rdquo;, then &ldquo;Finish&rdquo;:</p><p><img loading=lazy src=/images/freebsd/freebsd3.png alt=freebsd3>
4. We will now set up our two interfaces. Press on the first one, then on &ldquo;Advanced&rdquo;.</p><p><img loading=lazy src=/images/freebsd/freebsd4.png alt=freebsd4>
5. Press &ldquo;Generate&rdquo;, and <em><strong>note</strong></em> (I insist) the last two bytes of the MAC address that was just generated. It&rsquo;s normal to not have the same value as me 😉 . Then &ldquo;OK&rdquo;.</p><p><img loading=lazy src=/images/freebsd/freebsd5.png alt=freebsd5>
6. Then press the &ldquo;Lan Segments&rdquo; button:</p><p><img loading=lazy src=/images/freebsd/freebsd6.png alt=freebsd6>
7. We will create a new LAN segment. Click on &ldquo;Add&rdquo;, give it the name you want, then &ldquo;OK&rdquo;.</p><p><img loading=lazy src=/images/freebsd/freebsd7.png alt=freebsd7>
8. Finally, still on the first interface, in the &ldquo;Network Connection&rdquo; section, select LAN segment, then choose the LAN segment you just created.</p><p><img loading=lazy src=/images/freebsd/freebsd8.png alt=freebsd8></p><p>We have just specified that the first interface will be part of the LAN.</p><p>For the second interface of our Pfsense router, repeat the 4th and 5th step of configuration of the first interface. Then select &ldquo;Bridged&rdquo;, and &ldquo;OK&rdquo; (bottom right).</p><p><img loading=lazy src=/images/freebsd/freebsd9.png alt=freebsd9></p><p>Our Pfsense virtual machine is now ready to start!</p><p>⚠️Also think about configuring the &ldquo;PC1&rdquo; machine. To do this, choose the &ldquo;Network Adaptater&rdquo; of your VM, then again select &ldquo;LAN segment&rdquo;, choosing the LAN segment you put for the first interface of the Pfsense router:</p><p><img loading=lazy src=/images/freebsd/freebsd8.png alt=freebsd8></p><p>You can then start your Pfsense machine.</p><p><em><strong>The next part of this tutorial is ➡️ <a href=/proxy/proxy2>here</a> ⬅️</strong></em></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.thomaswimart.fr/tags/proxy/>proxy</a></li><li><a href=https://www.thomaswimart.fr/tags/pfsense/>pfsense</a></li></ul><nav class=paginav><a class=prev href=https://www.thomaswimart.fr/posts/vmware/><span class=title>« Prev</span><br><span>Create a virtual machine with Vmware</span></a>
<a class=next href=https://www.thomaswimart.fr/posts/cisco-config/><span class=title>Next »</span><br><span>Basic configuration for a Cisco device</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.thomaswimart.fr/>WIMART Thomas</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>