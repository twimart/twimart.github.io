<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Create a NTP server with Chrony and synchronize its equipements | WIMART Thomas</title><meta name=keywords content><meta name=description content="‚ö† I&rsquo;m using a Debian machine for my Chrony server
Things to do on your server (Linux or Windows) Firstly, install Chrony:
sudo -s apt install chrony We can then check the content of the &ldquo;chrony.conf&rdquo; file:
nano /etc/chrony/chrony.conf Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:
pool 2.debian.pool.ntp.org iburst
become:
#pool 2.debian.pool.ntp.org iburst
and now we can add our pools by entering the following lines instead:"><meta name=author content="Thomas"><link rel=canonical href=https://www.thomaswimart.fr/posts/chrony/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.thomaswimart.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.thomaswimart.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.thomaswimart.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://www.thomaswimart.fr/apple-touch-icon.png><link rel=mask-icon href=https://www.thomaswimart.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.thomaswimart.fr/posts/chrony/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Create a NTP server with Chrony and synchronize its equipements"><meta property="og:description" content="‚ö† I&rsquo;m using a Debian machine for my Chrony server
Things to do on your server (Linux or Windows) Firstly, install Chrony:
sudo -s apt install chrony We can then check the content of the &ldquo;chrony.conf&rdquo; file:
nano /etc/chrony/chrony.conf Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:
pool 2.debian.pool.ntp.org iburst
become:
#pool 2.debian.pool.ntp.org iburst
and now we can add our pools by entering the following lines instead:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.thomaswimart.fr/posts/chrony/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-06T09:24:04+01:00"><meta property="article:modified_time" content="2023-01-06T09:24:04+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Create a NTP server with Chrony and synchronize its equipements"><meta name=twitter:description content="‚ö† I&rsquo;m using a Debian machine for my Chrony server
Things to do on your server (Linux or Windows) Firstly, install Chrony:
sudo -s apt install chrony We can then check the content of the &ldquo;chrony.conf&rdquo; file:
nano /etc/chrony/chrony.conf Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:
pool 2.debian.pool.ntp.org iburst
become:
#pool 2.debian.pool.ntp.org iburst
and now we can add our pools by entering the following lines instead:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.thomaswimart.fr/posts/"},{"@type":"ListItem","position":2,"name":"Create a NTP server with Chrony and synchronize its equipements","item":"https://www.thomaswimart.fr/posts/chrony/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Create a NTP server with Chrony and synchronize its equipements","name":"Create a NTP server with Chrony and synchronize its equipements","description":"‚ö† I\u0026rsquo;m using a Debian machine for my Chrony server\nThings to do on your server (Linux or Windows) Firstly, install Chrony:\nsudo -s apt install chrony We can then check the content of the \u0026ldquo;chrony.conf\u0026rdquo; file:\nnano /etc/chrony/chrony.conf Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:\npool 2.debian.pool.ntp.org iburst\nbecome:\n#pool 2.debian.pool.ntp.org iburst\nand now we can add our pools by entering the following lines instead:","keywords":[],"articleBody":"‚ö† I‚Äôm using a Debian machine for my Chrony server\nThings to do on your server (Linux or Windows) Firstly, install Chrony:\nsudo -s apt install chrony We can then check the content of the ‚Äúchrony.conf‚Äù file:\nnano /etc/chrony/chrony.conf Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:\npool 2.debian.pool.ntp.org iburst\nbecome:\n#pool 2.debian.pool.ntp.org iburst\nand now we can add our pools by entering the following lines instead:\nserver 0.fr.pool.ntp.org server 1.fr.pool.ntp.org server 2.fr.pool.ntp.org server 3.fr.pool.ntp.org Once this is done we can go a little further down to check the existence (or not) of the following lines:\n# This directive specify the file into which chronyd will store the rate # information. driftfile /var/lib/chrony/chrony.drift local stratum 8 manual allow If these lines are not present, they must be modified as above.\nThe local stratum 8 declares the ‚Äúlayer‚Äù of our NTP server. To finish this installation we have to start the server.\nsystemctl start chrony we check that the service has started correctly:\nsystemctl status chrony And finally the command that is used to activate the service every time the machine is turned on:\nsystemctl enable chrony Things to do on your equipment (in this case it‚Äôs a cisco switch) Article from IT-Connect.fr, by Florian Burnel\nFor the moment, the router is not synchronized via the NTP server, we can consult the current time thanks to the command ‚Äúshow clock‚Äù, we notice that the time is not good at all‚Ä¶\nSwitchToto#show clock *0:8:8.942 UTC Mon Mar 1 1993 Let‚Äôs move on to the configuration, which is very simple since all you have to do is indicate the address of the NTP server. Here is the configuration procedure:\nRouter#configure terminal Enter configuration commands, one per line. End with CNTL/Z. Router(config)#ntp server 192.168.1.10 Router(config)#exit We can check that our switch is associated with the ntp server:\nRouter#show ntp association Display the date and time again, normally it should be updated:\nRouter#show clock *11:51:11.134 UTC Fri Jan 1 2023 And your equipment is well synchronized!\nThanks to Enzo Ribeiro for his help. üòä\n","wordCount":"352","inLanguage":"en","datePublished":"2023-01-06T09:24:04+01:00","dateModified":"2023-01-06T09:24:04+01:00","author":{"@type":"Person","name":"Thomas"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.thomaswimart.fr/posts/chrony/"},"publisher":{"@type":"Organization","name":"WIMART Thomas","logo":{"@type":"ImageObject","url":"https://www.thomaswimart.fr/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.thomaswimart.fr/ accesskey=h title="WIMART Thomas (Alt + H)"><img src=https://www.thomaswimart.fr/apple-touch-icon.png alt aria-label=logo height=30>WIMART Thomas</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.thomaswimart.fr/fr/ title=French aria-label="üåç FR ">üåç FR</a></li></ul></div></div><ul id=menu><li><a href=https://www.thomaswimart.fr/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://www.thomaswimart.fr/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.thomaswimart.fr/search/ title="Search üîç (Alt + /)" accesskey=/><span>Search üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.thomaswimart.fr/>Home</a>&nbsp;¬ª&nbsp;<a href=https://www.thomaswimart.fr/posts/>Posts</a></div><h1 class=post-title>Create a NTP server with Chrony and synchronize its equipements</h1><div class=post-meta><span title='2023-01-06 09:24:04 +0100 +0100'>January 6, 2023</span>&nbsp;¬∑&nbsp;2 min&nbsp;¬∑&nbsp;Thomas</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#things-to-do-on-your-server-linux-or-windows aria-label="Things to do on your server (Linux or Windows)">Things to do on your server (Linux or Windows)</a></li><li><a href=#things-to-do-on-your-equipment-in-this-case-its-a-cisco-switch aria-label="Things to do on your equipment (in this case it&amp;rsquo;s a cisco switch)">Things to do on your equipment (in this case it&rsquo;s a cisco switch)</a></li></ul></div></details></div><div class=post-content><p>‚ö† <strong>I&rsquo;m using a Debian machine for my Chrony server</strong></p><h2 id=things-to-do-on-your-server-linux-or-windows>Things to do on your server (Linux or Windows)<a hidden class=anchor aria-hidden=true href=#things-to-do-on-your-server-linux-or-windows>#</a></h2><p>Firstly, install Chrony:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>sudo -s
</span></span></span><span class=line><span class=cl><span class=go>apt install chrony
</span></span></span></code></pre></div><p>We can then check the content of the &ldquo;chrony.conf&rdquo; file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>nano /etc/chrony/chrony.conf
</span></span></span></code></pre></div><p>Then we have to declare our NTP pool. We will go to line 3 of the file to make some changes:</p><p><code>pool 2.debian.pool.ntp.org iburst</code></p><p>become:</p><p><code>#pool 2.debian.pool.ntp.org iburst</code></p><p>and now we can add our pools by entering the following lines instead:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>server 0.fr.pool.ntp.org
</span></span></span><span class=line><span class=cl><span class=go>server 1.fr.pool.ntp.org
</span></span></span><span class=line><span class=cl><span class=go>server 2.fr.pool.ntp.org
</span></span></span><span class=line><span class=cl><span class=go>server 3.fr.pool.ntp.org
</span></span></span></code></pre></div><p>Once this is done we can go a little further down to check the existence (or not) of the following lines:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> This directive specify the file into which chronyd will store the rate
</span></span><span class=line><span class=cl><span class=gp>#</span> information.
</span></span><span class=line><span class=cl><span class=go>driftfile /var/lib/chrony/chrony.drift
</span></span></span><span class=line><span class=cl><span class=go>local stratum 8
</span></span></span><span class=line><span class=cl><span class=go>manual
</span></span></span><span class=line><span class=cl><span class=go>allow 
</span></span></span></code></pre></div><p>If these lines are not present, they must be modified as above.</p><p>The <code>local stratum 8</code> declares the &ldquo;layer&rdquo; of our NTP server. To finish this installation we have to start the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>systemctl start chrony
</span></span></span></code></pre></div><p>we check that the service has started correctly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>systemctl status chrony
</span></span></span></code></pre></div><p>And finally the command that is used to activate the service every time the machine is turned on:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>systemctl enable chrony
</span></span></span></code></pre></div><h2 id=things-to-do-on-your-equipment-in-this-case-its-a-cisco-switch>Things to do on your equipment (in this case it&rsquo;s a cisco switch)<a hidden class=anchor aria-hidden=true href=#things-to-do-on-your-equipment-in-this-case-its-a-cisco-switch>#</a></h2><p><em><strong>Article from IT-Connect.fr, by Florian Burnel</strong></em></p><p>For the moment, the router is not synchronized via the NTP server, we can consult the current time thanks to the command &ldquo;show clock&rdquo;, we notice that the time is not good at all&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>SwitchToto#show clock
</span></span></span><span class=line><span class=cl><span class=go>*0:8:8.942 UTC Mon Mar 1 1993
</span></span></span></code></pre></div><p>Let&rsquo;s move on to the configuration, which is very simple since all you have to do is indicate the address of the NTP server. Here is the configuration procedure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Router#configure terminal
</span></span></span><span class=line><span class=cl><span class=go>Enter configuration commands, one per line. End with CNTL/Z.
</span></span></span><span class=line><span class=cl><span class=go>Router(config)#ntp server 192.168.1.10
</span></span></span><span class=line><span class=cl><span class=go>Router(config)#exit
</span></span></span></code></pre></div><p>We can check that our switch is associated with the ntp server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Router#show ntp association
</span></span></span></code></pre></div><p>Display the date and time again, normally it should be updated:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Router#show clock
</span></span></span><span class=line><span class=cl><span class=go>*11:51:11.134 UTC Fri Jan 1 2023
</span></span></span></code></pre></div><p>And your equipment is well synchronized!</p><p>Thanks to <strong><a href=https://enzo-ribeiro.github.io/portfolio>Enzo Ribeiro</a></strong> for his help. üòä</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.thomaswimart.fr/posts/tftp/><span class=title>¬´ Prev</span><br><span>Create a TFTP server and backup and restore device configurations</span></a>
<a class=next href=https://www.thomaswimart.fr/posts/vmware/><span class=title>Next ¬ª</span><br><span>Create a virtual machine with Vmware</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.thomaswimart.fr/>WIMART Thomas</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>