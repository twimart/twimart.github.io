<!DOCTYPE html>
<html lang="fr" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CrÃ©er un serveur proxy avec Pfsense et Squid | Thomas WIMART</title>
<meta name="keywords" content="">
<meta name="description" content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel Vmware Workstation 16 Pro.
Topologie de notre rÃ©seau Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:
Pour accÃ©der Ã  Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du rÃ©seau local &ldquo;LAN&rdquo;. Ici la subtilitÃ© est que si &ldquo;Linux&rdquo; veut accÃ©der Ã  certaines page web, ces requÃªtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;.">
<meta name="author" content="Thomas">
<link rel="canonical" href="https://twimart.github.io/fr/notes/proxy/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3299c596a7007118365635c056dd427dace22b7b8c1341fdef6fa6c31359ba10.css" integrity="sha256-MpnFlqcAcRg2VjXAVt1CfaziK3uME0H972&#43;mwxNZuhA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://twimart.github.io/favicon.ico/">
<link rel="icon" type="image/png" sizes="16x16" href="https://twimart.github.io/favicon-16x16.png/">
<link rel="icon" type="image/png" sizes="32x32" href="https://twimart.github.io/favicon-32x32.png/">
<link rel="apple-touch-icon" href="https://twimart.github.io/apple-touch-icon.png/">
<link rel="mask-icon" href="https://twimart.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="fr" href="https://twimart.github.io/fr/notes/proxy/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="CrÃ©er un serveur proxy avec Pfsense et Squid" />
<meta property="og:description" content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel Vmware Workstation 16 Pro.
Topologie de notre rÃ©seau Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:
Pour accÃ©der Ã  Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du rÃ©seau local &ldquo;LAN&rdquo;. Ici la subtilitÃ© est que si &ldquo;Linux&rdquo; veut accÃ©der Ã  certaines page web, ces requÃªtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://twimart.github.io/fr/notes/proxy/" /><meta property="article:section" content="notes" />
<meta property="article:published_time" content="2022-12-01T09:04:41+01:00" />
<meta property="article:modified_time" content="2022-12-01T09:04:41+01:00" /><meta property="og:site_name" content="Thomas WIMART" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CrÃ©er un serveur proxy avec Pfsense et Squid"/>
<meta name="twitter:description" content="Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel Vmware Workstation 16 Pro.
Topologie de notre rÃ©seau Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:
Pour accÃ©der Ã  Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du rÃ©seau local &ldquo;LAN&rdquo;. Ici la subtilitÃ© est que si &ldquo;Linux&rdquo; veut accÃ©der Ã  certaines page web, ces requÃªtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Notes",
      "item": "https://twimart.github.io/fr/notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CrÃ©er un serveur proxy avec Pfsense et Squid",
      "item": "https://twimart.github.io/fr/notes/proxy/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CrÃ©er un serveur proxy avec Pfsense et Squid",
  "name": "CrÃ©er un serveur proxy avec Pfsense et Squid",
  "description": "Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel Vmware Workstation 16 Pro.\nTopologie de notre rÃ©seau Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:\nPour accÃ©der Ã  Internet, le PC \u0026ldquo;Linux\u0026rdquo; passera par le routeur \u0026ldquo;Pfsense\u0026rdquo;, afin de sortir du rÃ©seau local \u0026ldquo;LAN\u0026rdquo;. Ici la subtilitÃ© est que si \u0026ldquo;Linux\u0026rdquo; veut accÃ©der Ã  certaines page web, ces requÃªtes passeront d\u0026rsquo;abord par notre serveur proxy \u0026ldquo;Squid\u0026rdquo;.",
  "keywords": [
    
  ],
  "articleBody": "Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel Vmware Workstation 16 Pro.\nTopologie de notre rÃ©seau Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:\nPour accÃ©der Ã  Internet, le PC â€œLinuxâ€ passera par le routeur â€œPfsenseâ€, afin de sortir du rÃ©seau local â€œLANâ€. Ici la subtilitÃ© est que si â€œLinuxâ€ veut accÃ©der Ã  certaines page web, ces requÃªtes passeront dâ€™abord par notre serveur proxy â€œSquidâ€. â€œSquidâ€ pourra alors bloquer certaines pages web ou encore enregistrer certaine donnÃ©es dans sont cache afin dâ€™amÃ©liorer les performances.\nJe prÃ©cise que ce shÃ©ma ne sert que dâ€™illustration, Pfsense et Squid ne forment en rÃ©alitÃ© quâ€™une seule machine dans notre cas.\nCrÃ©ation des machines virtuelles Sur la page de tÃ©lÃ©chargement de Pfsense, tÃ©lÃ©charger lâ€™iso de notre futur routeur virtuel. Je prÃ©cise que vous allez obtenir fichier .gz, vous devez extraire ce fichier sur votre ordinateur.\nTÃ©lÃ©chargez aussi lâ€™iso dâ€™une VM, pour PC1. Personnellement, je vais utiliser une distribution Linux Ubuntu, qui fera amplement lâ€™affaire, mais vous Ãªtes libre dâ€™utiliser nâ€™importe quel OS que vous maitrisez.\nEnsuite, sur Vmware, vous pouvez crÃ©er les machines virtuelles (vous pouvez mon suivre mon tutoriel ici.)\nParamÃ©trage des machines virtuelles Une fois les machines crÃ©Ã©es, on va devoir modifier leurs paramÃ¨tres. En effet, notre routeur Pfsense possÃ¨de 2 interfaces: une LAN et une WAN. On va donc devoir lui en ajouter une, et les paramÃ©trer corectement.\nâš ï¸ Il faut que votre ordinateur soit connectÃ© Ã  Internet.\nAllez dans les paramÃ¨tres de la VM: Appuyez sur â€œAddâ€: SÃ©lectionnez â€œNetwork Adaptaterâ€, puis â€œFinishâ€: On va maintenant paramÃ©trer nos deux interfaces. Appuyez sur la premiÃ¨re, puis sur â€œAdvancedâ€ Appuyer sur â€œGenerateâ€, et notez bien (si, si, jâ€™insiste) les deux derniers octets de lâ€™addresse MAC qui vient dâ€™Ãªtre gÃ©nÃ©rÃ©e. Câ€™est normal de ne pas avoir la mÃªme valeur que moi ğŸ˜‰ . Puis â€œOKâ€. Ensuite, appuyez sur le bouton â€œLan Segmentsâ€: On va crÃ©er un nouveau segment LAN. Cliquez sur â€œAddâ€, donner lui le nom que vous voulez, puis â€œOKâ€. Enfin, toujours sur la premiÃ¨re interface, dans la section â€œNetwork Connectionâ€, sÃ©lectionnez LAN segment, puis choisissez le segment LAN que vous venez de crÃ©er. Nous venons ici de preciser que la premiÃ¨re interface fera partie du LAN.\nPour la deuxiÃ¨me interface de notre routeur Pfsense, rÃ©pÃ©tez la 4iÃ¨me et 5iÃ¨me Ã©tape de configuration de la premiÃ¨re interface. Puis sÃ©lelectionnez â€œBridgedâ€, et â€œOKâ€ (en bas Ã  droite).\nNotre machine virtuelle Pfsense est maintenant prÃªte Ã  dÃ©marrer!\nâš ï¸Pensez aussi Ã  configurer la machine â€œPC1â€. Pour cela, choisissez le â€œNetwork Adaptaterâ€ de votre VM, puis lÃ  encore sÃ©lectionnez â€œLAN segmentâ€, en choisissant le segement LAN que vous mis pour la premiÃ¨re interface du routeur Pfsense:\nVous pouvez alors dÃ©marrer votre machine Pfsense.\nInstallation de Pfsense Cliquer sur â€œAcceptâ€.\nSÃ©lectionnez â€œInstallâ€, puis â€œOKâ€\nLâ€™installateur va alors vous demander de sÃ©lectionner la disposition de votre clavier (jâ€™ai un clavier franÃ§ais). SÃ©lectionnez la disposition qui vous convient, puis appuyer sur â€œSelectâ€.\nConfirmer votre choix.\nOn nous demande ensuite comment partionner notre disque. Choisissez â€œAuto (UFS) BIOSâ€, puis â€œOKâ€.\nPfsense va alors dÃ©mmarer son installation:\nSi lâ€™installateur vous demande dâ€™ouvrir un Shell, rÃ©pondez â€œnonâ€\nVous redÃ©marrerez la machine virtuelle quand lâ€™installateur vous le proposera.\nConfiguration de dÃ©marrage de Pfsense Au redÃ©marrage, on vous demandera si les VLANS doivent Ãªtre configurÃ©s. Appuyez sur â€œnâ€ puis â€œEnterâ€\nEnsuite, vous devez dire Ã  Pfsense quelles interfaces correspondent au WAN et au LAN. Pour lâ€™instant, on ne sait pas Ã  quoi correspond â€œem0â€ et â€œem1â€ donc mettons au hasard (on pourra modifier cela plus tard).\nPuis confirmer en appuyant sur â€œyâ€:\nEt nous avons enfin fini lâ€™installation de Pfsense! Vous devrez maintenant arriver sur le menu de configuration principal.\nPas de panique si vous nâ€™avez pas dâ€™adresses IP pour â€œem0â€ ou â€œem1â€ (comme moi), on va rÃ¨gler cela tout de suite!\nAppuyer sur la touche â€œ1â€ du clavier afin dâ€™assigner les interfaces correctement.\nNous remarquons alors quâ€™Ã  cotÃ© de â€œem0â€ et â€œem1â€, il y a des adresses MACâ€¦\nLâ€™assistant nous (re)demande si nous voulons confiugurer les VLANS. Appuyer sur â€œnâ€.\nPuis on nous demande quel interface correspond au WAN. Mais comment le savoir? â€œem0â€? â€œem1â€? Une petite explication sâ€™impose.\nLorsque nous avons configurÃ© les interfaces de la VM de Pfsense, nous en avons mis une en â€œLAN segmentâ€ et une autre en â€œBridgedâ€. Celle en â€œLAN segmentâ€ correspond au cotÃ© LAN de Pfsense, tandis que la â€œBridgedâ€ correspond au cotÃ© WAN.\nMais comment savoir laquelle correspond Ã  â€œem0â€ ou Ã  â€œem1â€? Avec les adresses MAC que vous avez normalement notÃ© un peu plus tÃ´t ! Dans mon cas, je sais donc que lâ€™interface LAN Ã  une adresse MAC qui se finit par :d9:f4 ; et que lâ€™interface WAN se termine par :6a:69.\nCâ€™est marquÃ© juste au dessus laquelle correspond Ã  quoi.\nVous pouvez donc entrer lâ€™interface qui correspond au cotÃ© WAN (dans mon cas, â€œem0â€):\nFaites de mÃªme avec lâ€™interface LAN:\nAppuyer sur â€œyâ€ pour confirmer les changements:\nPersonnellement, je vais changer lâ€™adresse IP de mon interface LAN, je vais don choisir lâ€™option 2:\nJe vais lui donner lâ€™addresse IP 192.168.100.254, avec un masque en /24. (Je spÃ©cifie aussi que je ne veux pas utiliser le DHCP.)\nConfiguration de PC1 On va maintenant se concentrer sur PC1. Rassurez-vous, câ€™est plus simple!\nâš ï¸Comme dit plus tÃ´t, je vais travailler ici avec une machine Linux Ubuntu, donc les commandes et les manipulations qui vont suivre ne sont que valides pour cet OS.\nSur votre machine, lancer un terminal, puis faites la commande nmtui\nSÃ©lectionnez â€œEdit Connectionâ€, puis â€œWired Connexion 1â€. Vous devriez arriver sur un Ã©cran similaire au mien. Modifier les paramÃ¨tre comme lâ€™image ci-dessous, puis â€œOKâ€ (Pour Gateway, il faut mettre lâ€™IP de lâ€™interface LAN de Pfsense).\nPour Ãªtre certain que les changements ont Ã©tÃ© pris en compte, dÃ©sactivez et rÃ©activez lâ€™interface (toujours avec nmtui).\nSi tout ce passe bien, vous devriez pouvoir ping la machine Pfsense ! â¡ï¸ ping Lancer votre navigateur, puis inscivez-y lâ€™IP de la VM Pfsense. On arrive sur la page de connexion. Mettez admin pour le nom dâ€™utilisateur, et pfsense pour le mot de passe.\nConfiguration dÃ©taillÃ© de Pfsense Une fois connectÃ©, vous allez faire face Ã  un assistant. Cliquez sur â€œNextâ€ jusquâ€™a tomber sur la fenÃªtre ci-dessous:\nInscivez la mÃªme configuration que moi.\nSÃ©lectionnez votre fuseau horaire, puis â€œNextâ€:\nLaissez les paramÃ¨tre par dÃ©faut, puis â€œNextâ€:\nIdem pour cette fenÃªtre:\nInscrivez le nouveau mot de passe pour accÃ¨der Pfsense depuis le Web ou en SSH:\nEnfin, appuyer sur le bouton â€œReloadâ€, et â€œFinishâ€.\nNous nous retrouvons donc sur la page principale de â€œmonitoringâ€ de Pfsense.\nNaviguer dans le menus â€œFirewallâ€, puis â€œRulesâ€, et sÃ©lectionnez lâ€™interface WAN. Puis appuyez sur le bouton â€œAddâ€.\nOn va ici crÃ©er une rÃ¨gle de pare-feu, afin dâ€™avoir accÃ¨s Ã  Internet depuis PC1. En effet, pour lâ€™instant, il est impossible dâ€™accÃ©der Ã  une page web depuis PC1, car les trames Ethernet sont bloquÃ©es par notre routeur virtuel Pfsense.\nLa suite arrive bientÃ´t ğŸ˜‰!\n",
  "wordCount" : "1169",
  "inLanguage": "fr",
  "datePublished": "2022-12-01T09:04:41+01:00",
  "dateModified": "2022-12-01T09:04:41+01:00",
  "author":{
    "@type": "Person",
    "name": "Thomas"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://twimart.github.io/fr/notes/proxy/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Thomas WIMART",
    "logo": {
      "@type": "ImageObject",
      "url": "https://twimart.github.io/favicon.ico/"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://twimart.github.io/fr/" accesskey="h" title="WIMART Thomas (Alt + H)">
                <img src="https://twimart.github.io/apple-touch-icon.png" alt="" aria-label="logo"
                    height="30">WIMART Thomas</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://twimart.github.io/" title="Anglais"
                            aria-label="ğŸŒ EN ">ğŸŒ EN </a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://twimart.github.io/fr/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://twimart.github.io/fr/frtags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://twimart.github.io/fr/search/" title="Recherche ğŸ” (Alt &#43; /)" accesskey=/>
                    <span>Recherche ğŸ”</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://twimart.github.io/fr/">Accueil</a>&nbsp;Â»&nbsp;<a href="https://twimart.github.io/fr/notes/">Notes</a></div>
    <h1 class="post-title">
      CrÃ©er un serveur proxy avec Pfsense et Squid
    </h1>
    <div class="post-meta"><span title='2022-12-01 09:04:41 +0100 CET'>dÃ©cembre 1, 2022</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;Thomas

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table des matiÃ¨res</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#topologie-de-notre-r%c3%a9seau" aria-label="Topologie de notre rÃ©seau">Topologie de notre rÃ©seau</a></li>
                <li>
                    <a href="#cr%c3%a9ation-des-machines-virtuelles" aria-label="CrÃ©ation des machines virtuelles">CrÃ©ation des machines virtuelles</a></li>
                <li>
                    <a href="#param%c3%a9trage-des-machines-virtuelles" aria-label="ParamÃ©trage des machines virtuelles">ParamÃ©trage des machines virtuelles</a></li>
                <li>
                    <a href="#installation-de-pfsense" aria-label="Installation de Pfsense">Installation de Pfsense</a></li>
                <li>
                    <a href="#configuration-de-d%c3%a9marrage-de-pfsense" aria-label="Configuration de dÃ©marrage de Pfsense">Configuration de dÃ©marrage de Pfsense</a></li>
                <li>
                    <a href="#configuration-de-pc1" aria-label="Configuration de PC1">Configuration de PC1</a></li>
                <li>
                    <a href="#configuration-d%c3%a9taill%c3%a9-de-pfsense" aria-label="Configuration dÃ©taillÃ© de Pfsense">Configuration dÃ©taillÃ© de Pfsense</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Dans cette note, nous allons voir comment installer un serveur proxy, en utilisant Pfsense et Squid. On utilisera des machines virtuelles, crÃ©Ã©es sous le logiciel <em>Vmware Workstation 16 Pro</em>.</p>
<h2 id="topologie-de-notre-rÃ©seau">Topologie de notre rÃ©seau<a hidden class="anchor" aria-hidden="true" href="#topologie-de-notre-rÃ©seau">#</a></h2>
<p>Voila la topologie du rÃ©seau que nous allons utiliser dans ce tuto:</p>
<p><img loading="lazy" src="/images/reseau.png" alt="reseau"  />
</p>
<p>Pour accÃ©der Ã  Internet, le PC &ldquo;Linux&rdquo; passera par le routeur &ldquo;Pfsense&rdquo;, afin de sortir du rÃ©seau local &ldquo;LAN&rdquo;. Ici la subtilitÃ© est que si &ldquo;Linux&rdquo; veut accÃ©der Ã  certaines page web, ces requÃªtes passeront d&rsquo;abord par notre serveur proxy &ldquo;Squid&rdquo;. <br>
&ldquo;Squid&rdquo; pourra alors bloquer certaines pages web ou encore enregistrer certaine donnÃ©es dans sont cache afin d&rsquo;amÃ©liorer les performances.</p>
<p><em>Je prÃ©cise que ce shÃ©ma ne sert que d&rsquo;illustration, Pfsense et Squid ne forment en rÃ©alitÃ© qu&rsquo;une seule machine dans notre cas.</em></p>
<h2 id="crÃ©ation-des-machines-virtuelles">CrÃ©ation des machines virtuelles<a hidden class="anchor" aria-hidden="true" href="#crÃ©ation-des-machines-virtuelles">#</a></h2>
<p>Sur la page de tÃ©lÃ©chargement de <a href="https://www.pfsense.org/download/">Pfsense</a>, tÃ©lÃ©charger l&rsquo;iso de notre futur routeur virtuel. Je prÃ©cise que vous allez obtenir fichier .gz, vous devez extraire ce fichier sur votre ordinateur.</p>
<p>TÃ©lÃ©chargez aussi l&rsquo;iso d&rsquo;une VM, pour PC1. Personnellement, je vais utiliser une distribution Linux Ubuntu, qui fera amplement l&rsquo;affaire, mais vous Ãªtes libre d&rsquo;utiliser n&rsquo;importe quel OS que vous maitrisez.</p>
<p>Ensuite, sur Vmware, vous pouvez crÃ©er les machines virtuelles (vous pouvez mon suivre mon tutoriel <a href="/fr/notes/vmware">ici</a>.)</p>
<h2 id="paramÃ©trage-des-machines-virtuelles">ParamÃ©trage des machines virtuelles<a hidden class="anchor" aria-hidden="true" href="#paramÃ©trage-des-machines-virtuelles">#</a></h2>
<p>Une fois les machines crÃ©Ã©es, on va devoir modifier leurs paramÃ¨tres. En effet, notre routeur Pfsense possÃ¨de 2 interfaces: une LAN et une WAN. On va donc devoir lui en ajouter une, et les paramÃ©trer corectement.</p>
<p>âš ï¸ <em><strong>Il faut que votre ordinateur soit connectÃ© Ã  Internet.</strong></em></p>
<ol>
<li>Allez dans les paramÃ¨tres de la VM:</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd1.png" alt="freebsd1"  />
</p>
<ol start="2">
<li>Appuyez sur &ldquo;Add&rdquo;:</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd2.png" alt="freebsd2"  />
</p>
<ol start="3">
<li>SÃ©lectionnez &ldquo;Network Adaptater&rdquo;, puis &ldquo;Finish&rdquo;:</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd3.png" alt="freebsd3"  />
</p>
<ol start="4">
<li>On va maintenant paramÃ©trer nos deux interfaces. Appuyez sur la premiÃ¨re, puis sur &ldquo;Advanced&rdquo;</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd4.png" alt="freebsd4"  />
</p>
<ol start="5">
<li>Appuyer sur &ldquo;Generate&rdquo;, et  <em><strong>notez bien</strong></em> (si, si, j&rsquo;insiste) les deux derniers octets de l&rsquo;addresse MAC qui vient d&rsquo;Ãªtre gÃ©nÃ©rÃ©e. C&rsquo;est normal de ne pas avoir la mÃªme valeur que moi ğŸ˜‰ . Puis &ldquo;OK&rdquo;.</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd5.png" alt="freebsd5"  />
</p>
<ol start="6">
<li>Ensuite, appuyez sur le bouton &ldquo;Lan Segments&rdquo;:</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd6.png" alt="freebsd6"  />
</p>
<ol start="7">
<li>On va crÃ©er un nouveau segment LAN. Cliquez sur &ldquo;Add&rdquo;, donner lui le nom que vous voulez, puis &ldquo;OK&rdquo;.</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd7.png" alt="freebsd7"  />
</p>
<ol start="8">
<li>Enfin, toujours sur la premiÃ¨re interface, dans la section &ldquo;Network Connection&rdquo;, sÃ©lectionnez LAN segment, puis choisissez le segment LAN que vous venez de crÃ©er.</li>
</ol>
<p><img loading="lazy" src="/images/freebsd/freebsd8.png" alt="freebsd8"  />
</p>
<p>Nous venons ici de preciser que la premiÃ¨re interface fera partie du LAN.</p>
<p>Pour la deuxiÃ¨me interface de notre routeur Pfsense, rÃ©pÃ©tez la 4iÃ¨me et 5iÃ¨me Ã©tape de configuration de la premiÃ¨re interface. Puis sÃ©lelectionnez &ldquo;Bridged&rdquo;, et &ldquo;OK&rdquo; (en bas Ã  droite).</p>
<p><img loading="lazy" src="/images/freebsd/freebsd9.png" alt="freebsd9"  />
</p>
<p>Notre machine virtuelle Pfsense est maintenant prÃªte Ã  dÃ©marrer!</p>
<p>âš ï¸Pensez aussi Ã  configurer la machine &ldquo;PC1&rdquo;. Pour cela, choisissez le &ldquo;Network Adaptater&rdquo; de votre VM, puis lÃ  encore sÃ©lectionnez &ldquo;LAN segment&rdquo;, en choisissant le segement LAN que vous mis pour la premiÃ¨re interface du routeur Pfsense:</p>
<p><img loading="lazy" src="/images/freebsd/freebsd8.png" alt="freebsd8"  />
</p>
<p>Vous pouvez alors dÃ©marrer votre machine Pfsense.</p>
<h2 id="installation-de-pfsense">Installation de Pfsense<a hidden class="anchor" aria-hidden="true" href="#installation-de-pfsense">#</a></h2>
<p><img loading="lazy" src="/images/pfsense/pfsense1.png" alt="pfsense1"  />
</p>
<p>Cliquer sur &ldquo;Accept&rdquo;.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense2.png" alt="pfsense2"  />
</p>
<p>SÃ©lectionnez &ldquo;Install&rdquo;, puis &ldquo;OK&rdquo;</p>
<p>L&rsquo;installateur va alors vous demander de sÃ©lectionner la disposition de votre clavier (j&rsquo;ai un clavier franÃ§ais). SÃ©lectionnez la disposition qui vous convient, puis appuyer sur &ldquo;Select&rdquo;.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense3.png" alt="pfsense3"  />
</p>
<p>Confirmer votre choix.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense4.png" alt="pfsense4"  />
</p>
<p>On nous demande ensuite comment partionner notre disque. Choisissez &ldquo;Auto (UFS) BIOS&rdquo;, puis &ldquo;OK&rdquo;.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense5.png" alt="pfsense5"  />
</p>
<p>Pfsense va alors dÃ©mmarer son installation:</p>
<p><img loading="lazy" src="/images/pfsense/pfsense6.png" alt="pfsense6"  />
</p>
<p>Si l&rsquo;installateur vous demande d&rsquo;ouvrir un Shell, rÃ©pondez &ldquo;non&rdquo;</p>
<p>Vous redÃ©marrerez la machine virtuelle quand l&rsquo;installateur vous le proposera.</p>
<h2 id="configuration-de-dÃ©marrage-de-pfsense">Configuration de dÃ©marrage de Pfsense<a hidden class="anchor" aria-hidden="true" href="#configuration-de-dÃ©marrage-de-pfsense">#</a></h2>
<p>Au redÃ©marrage, on vous demandera si les VLANS doivent Ãªtre configurÃ©s. Appuyez sur &ldquo;n&rdquo; puis &ldquo;Enter&rdquo;</p>
<p><img loading="lazy" src="/images/pfsense/pfsense7.png" alt="pfsense7"  />
</p>
<p>Ensuite, vous devez dire Ã  Pfsense quelles interfaces correspondent au WAN et au LAN. Pour l&rsquo;instant, on ne sait pas Ã  quoi correspond &ldquo;em0&rdquo; et &ldquo;em1&rdquo; donc mettons au hasard (on pourra modifier cela plus tard).</p>
<p><img loading="lazy" src="/images/pfsense/pfsense8.png" alt="pfsense8"  />
</p>
<p>Puis confirmer en appuyant sur &ldquo;y&rdquo;:</p>
<p><img loading="lazy" src="/images/pfsense/pfsense9.png" alt="pfsense9"  />
</p>
<p>Et nous avons enfin fini l&rsquo;installation de Pfsense! Vous devrez maintenant arriver sur le menu de configuration principal.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense10.png" alt="pfsense10"  />
</p>
<p>Pas de panique si vous n&rsquo;avez pas d&rsquo;adresses IP pour &ldquo;em0&rdquo; ou &ldquo;em1&rdquo; (comme moi), on va rÃ¨gler cela tout de suite!</p>
<p>Appuyer sur la touche &ldquo;1&rdquo; du clavier afin d&rsquo;assigner les interfaces correctement.</p>
<p><img loading="lazy" src="/images/pfsense/pfsense11.png" alt="pfsense11"  />
</p>
<p>Nous remarquons alors qu&rsquo;Ã  cotÃ© de &ldquo;em0&rdquo; et &ldquo;em1&rdquo;, il y a des adresses MAC&hellip;</p>
<p>L&rsquo;assistant nous (re)demande si nous voulons confiugurer les VLANS. Appuyer sur &ldquo;n&rdquo;.</p>
<p>Puis on nous demande quel interface correspond au WAN. Mais comment le savoir? &ldquo;em0&rdquo;? &ldquo;em1&rdquo;? Une petite explication s&rsquo;impose.</p>
<p>Lorsque nous avons configurÃ© les interfaces de la VM de Pfsense, nous en avons mis une en &ldquo;LAN segment&rdquo; et une autre en &ldquo;Bridged&rdquo;. Celle en &ldquo;LAN segment&rdquo; correspond au cotÃ© LAN de Pfsense, tandis que la &ldquo;Bridged&rdquo; correspond au cotÃ© WAN.</p>
<p>Mais comment savoir laquelle correspond Ã  &ldquo;em0&rdquo; ou Ã  &ldquo;em1&rdquo;? Avec les adresses MAC que vous avez normalement notÃ© un peu plus tÃ´t ! Dans mon cas, je sais donc que l&rsquo;interface LAN Ã  une adresse MAC qui se finit par :d9:f4 ; et que l&rsquo;interface WAN se termine par :6a:69.</p>
<p>C&rsquo;est marquÃ© juste au dessus laquelle correspond Ã  quoi.</p>
<p>Vous pouvez donc entrer l&rsquo;interface qui correspond au cotÃ© WAN (dans mon cas, &ldquo;em0&rdquo;):</p>
<p><img loading="lazy" src="/images/pfsense/pfsense12.png" alt="pfsense12"  />
</p>
<p>Faites de mÃªme avec l&rsquo;interface LAN:</p>
<p><img loading="lazy" src="/images/pfsense/pfsense13.png" alt="pfsense13"  />
</p>
<p>Appuyer sur &ldquo;y&rdquo; pour confirmer les changements:</p>
<p><img loading="lazy" src="/images/pfsense/pfsense14.png" alt="pfsense14"  />
</p>
<p>Personnellement, je vais changer l&rsquo;adresse IP de mon interface LAN, je vais don choisir l&rsquo;option 2:</p>
<p><img loading="lazy" src="/images/pfsense/pfsense15.png" alt="pfsense15"  />
</p>
<p>Je vais lui donner l&rsquo;addresse IP 192.168.100.254, avec un masque en /24. (Je spÃ©cifie aussi que je ne veux pas utiliser le DHCP.)</p>
<p><img loading="lazy" src="/images/pfsense/pfsense16.png" alt="pfsense16"  />
</p>
<h2 id="configuration-de-pc1">Configuration de PC1<a hidden class="anchor" aria-hidden="true" href="#configuration-de-pc1">#</a></h2>
<p>On va maintenant se concentrer sur PC1. Rassurez-vous, c&rsquo;est plus simple!</p>
<p>âš ï¸<em><strong>Comme dit plus tÃ´t, je vais travailler ici avec une machine Linux Ubuntu, donc les commandes et les manipulations qui vont suivre ne sont que valides pour cet OS.</strong></em></p>
<p>Sur votre machine, lancer un terminal, puis faites la commande <code>nmtui</code></p>
<p><img loading="lazy" src="/images/pc/pc1.png" alt="pc1"  />
</p>
<p>SÃ©lectionnez &ldquo;Edit Connection&rdquo;, puis &ldquo;Wired Connexion 1&rdquo;. Vous devriez arriver sur un Ã©cran similaire au mien. Modifier les paramÃ¨tre comme l&rsquo;image ci-dessous, puis &ldquo;OK&rdquo; (Pour Gateway, il faut mettre l&rsquo;IP de l&rsquo;interface LAN de Pfsense).</p>
<p><img loading="lazy" src="/images/pc/pc2.png" alt="pc2"  />
</p>
<p>Pour Ãªtre certain que les changements ont Ã©tÃ© pris en compte, dÃ©sactivez et rÃ©activez l&rsquo;interface (toujours avec <code>nmtui</code>).</p>
<p>Si tout ce passe bien, vous devriez pouvoir ping la machine Pfsense ! â¡ï¸ <code>ping &lt;ip_pfsense&gt;</code></p>
<p><img loading="lazy" src="/images/pc/pc3.png" alt="pc3"  />
</p>
<p>Lancer votre navigateur, puis inscivez-y l&rsquo;IP de la VM Pfsense. On arrive sur la page de connexion. Mettez <code>admin</code> pour le nom d&rsquo;utilisateur, et <code>pfsense</code> pour le mot de passe.</p>
<p><img loading="lazy" src="/images/pc/pc4.png" alt="pc4"  />
</p>
<h2 id="configuration-dÃ©taillÃ©-de-pfsense">Configuration dÃ©taillÃ© de Pfsense<a hidden class="anchor" aria-hidden="true" href="#configuration-dÃ©taillÃ©-de-pfsense">#</a></h2>
<p>Une fois connectÃ©, vous allez faire face Ã  un assistant. Cliquez sur &ldquo;Next&rdquo; jusqu&rsquo;a tomber sur la fenÃªtre ci-dessous:</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense1.png" alt="cpfsence1"  />
</p>
<p>Inscivez la mÃªme configuration que moi.</p>
<p>SÃ©lectionnez votre fuseau horaire, puis &ldquo;Next&rdquo;:</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense2.png" alt="cpfsence2"  />
</p>
<p>Laissez les paramÃ¨tre par dÃ©faut, puis &ldquo;Next&rdquo;:</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense3.png" alt="cpfsence3"  />
</p>
<p>Idem pour cette fenÃªtre:</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense4.png" alt="cpfsence4"  />
</p>
<p>Inscrivez le nouveau mot de passe pour accÃ¨der Pfsense depuis le Web ou  en SSH:</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense5.png" alt="cpfsence5"  />
</p>
<p>Enfin, appuyer sur le bouton &ldquo;Reload&rdquo;, et &ldquo;Finish&rdquo;.</p>
<p>Nous nous retrouvons donc sur la page principale de &ldquo;monitoring&rdquo; de Pfsense.</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense6.png" alt="cpfsence6"  />
</p>
<p>Naviguer dans le menus &ldquo;Firewall&rdquo;, puis &ldquo;Rules&rdquo;, et sÃ©lectionnez l&rsquo;interface WAN. Puis appuyez sur le bouton &ldquo;Add&rdquo;.</p>
<p><img loading="lazy" src="/images/cpfsense/cpfsense7.png" alt="cpfsence7"  />
</p>
<p>On va ici crÃ©er une rÃ¨gle de pare-feu, afin d&rsquo;avoir accÃ¨s Ã  Internet depuis PC1. En effet, pour l&rsquo;instant, il est impossible d&rsquo;accÃ©der Ã  une page web depuis PC1, car les trames Ethernet sont bloquÃ©es par notre routeur virtuel Pfsense.</p>
<p>La suite arrive bientÃ´t ğŸ˜‰!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://twimart.github.io/fr/frtags/pfsense/">pfsense</a></li>
      <li><a href="https://twimart.github.io/fr/frtags/proxy/">proxy</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://twimart.github.io/fr/notes/vmware/">
    <span class="title">Â« Page prÃ©cÃ©dente</span>
    <br>
    <span>CrÃ©er une machine virtuelle avec Vmware</span>
  </a>
  <a class="next" href="https://twimart.github.io/fr/notes/cisco-ssh/">
    <span class="title">Page suivante Â»</span>
    <br>
    <span>Etablir une connexion SSH sur un appareil Cisco</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://twimart.github.io/fr/">Thomas WIMART</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copier';

        function copyingDone() {
            copybutton.innerHTML = 'CopiÃ© !';
            setTimeout(() => {
                copybutton.innerHTML = 'Copier';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
